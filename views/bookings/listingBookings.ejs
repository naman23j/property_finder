<% layout("layouts/boilerplate") %>

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-1">
                <i class="fa-solid fa-calendar-check"></i> Bookings for <%= listing.title %>
            </h2>
            <p class="text-muted mb-0">
                <i class="fa-solid fa-location-dot"></i> <%= listing.location %>
            </p>
        </div>
        <a href="/listings/<%= listing._id %>" class="btn btn-outline-secondary">
            <i class="fa-solid fa-arrow-left"></i> Back to Listing
        </a>
    </div>

    <% if(bookings.length === 0) { %>
        <div class="text-center py-5">
            <i class="fa-regular fa-calendar-xmark" style="font-size: 5rem; color: #ccc;"></i>
            <h4 class="mt-3 text-muted">No bookings yet</h4>
            <p class="text-muted">Your property hasn't been booked yet.</p>
        </div>
    <% } else { %>
        <div class="row">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Guest</th>
                                        <th>Check-in</th>
                                        <th>Check-out</th>
                                        <th>Nights</th>
                                        <th>Guests</th>
                                        <th>Total</th>
                                        <th>Status</th>
                                        <th>Booked On</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% bookings.forEach(booking => { %>
                                        <tr>
                                            <td>
                                                <i class="fa-solid fa-user-circle text-muted"></i>
                                                <strong><%= booking.user.username %></strong>
                                            </td>
                                            <td><%= new Date(booking.checkIn).toLocaleDateString('en-IN') %></td>
                                            <td><%= new Date(booking.checkOut).toLocaleDateString('en-IN') %></td>
                                            <td><%= booking.numberOfNights %></td>
                                            <td><%= booking.guests %></td>
                                            <td class="fw-bold text-success">₹<%= booking.totalPrice.toLocaleString('en-IN') %></td>
                                            <td>
                                                <% if(booking.status === 'confirmed') { %>
                                                    <span class="badge bg-success">Confirmed</span>
                                                <% } else if(booking.status === 'pending') { %>
                                                    <span class="badge bg-warning">Pending</span>
                                                <% } else if(booking.status === 'cancelled') { %>
                                                    <span class="badge bg-danger">Cancelled</span>
                                                <% } else { %>
                                                    <span class="badge bg-secondary">Completed</span>
                                                <% } %>
                                            </td>
                                            <td class="text-muted small">
                                                <%= new Date(booking.createdAt).toLocaleDateString('en-IN') %>
                                            </td>
                                        </tr>
                                    <% }); %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Summary Stats -->
                <div class="row mt-4">
                    <div class="col-md-3">
                        <div class="card shadow-sm border-0 text-center">
                            <div class="card-body">
                                <h3 class="text-primary mb-0"><%= bookings.length %></h3>
                                <p class="text-muted mb-0">Total Bookings</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card shadow-sm border-0 text-center">
                            <div class="card-body">
                                <h3 class="text-success mb-0">
                                    <%= bookings.filter(b => b.status === 'confirmed').length %>
                                </h3>
                                <p class="text-muted mb-0">Confirmed</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card shadow-sm border-0 text-center">
                            <div class="card-body">
                                <h3 class="text-warning mb-0">
                                    <%= bookings.filter(b => b.status === 'pending').length %>
                                </h3>
                                <p class="text-muted mb-0">Pending</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card shadow-sm border-0 text-center">
                            <div class="card-body">
                                <h3 class="text-danger mb-0">
                                    ₹<%= bookings.reduce((sum, b) => sum + b.totalPrice, 0).toLocaleString('en-IN') %>
                                </h3>
                                <p class="text-muted mb-0">Total Revenue</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    <% } %>
</div>
